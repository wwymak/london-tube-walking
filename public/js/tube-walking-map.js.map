{"version":3,"sources":["../../es6_js/tube-walking-map.js"],"names":[],"mappings":";;;;;;AAIA,IAAI,SAAS,GAAG;AACZ,WAAO,EAAE,mBAAU;AACf,gBAAQ,CAAC,WAAW,GAAG,kEAAkE,CAAC;AAC1F,YAAI,GAAG,GAAG,IAAI,QAAQ,CAAC,GAAG,CAAC;AACvB,qBAAS,EAAE,KAAK;AAChB,iBAAK,EAAE,mCAAmC;AAC1C,kBAAM,EAAE,CAAC,CAAC,MAAM,EAAE,OAAO,CAAC;AAC1B,gBAAI,EAAE,EAAE;AACR,mBAAO,EAAE,CAAC;SACb,CAAC,CAAC;AACH,iBAAS,CAAC,WAAW,GAAG,EAAE;;;;;;;;;;;;;;;;;AAAC,AAiB3B,eAAO,GAAG,CAAC;KACd;;AAED,gBAAY,EAAE,wBAAW;AACrB,SAAC,CAAC,aAAa,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,UAAC,CAAC,EAAI;AAC/B,aAAC,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC;AAChE,aAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;AAC5C,aAAC,CAAC,oBAAoB,CAAC,CAAC,OAAO,CAAC,EAAC,OAAO,EAAE,GAAG,EAAC,EAAE,GAAG,EAAE,YAAM;AACvD,iBAAC,CAAC,eAAe,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;aAC/C,CAAC,CAAC;SACN,CAAC,CAAC;;AAEH,SAAC,CAAC,YAAY,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,UAAC,CAAC,EAAI;AAC9B,aAAC,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC;AAChE,aAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;AAC5C,aAAC,CAAC,oBAAoB,CAAC,CAAC,OAAO,CAAC,EAAC,OAAO,EAAE,GAAG,EAAC,EAAE,GAAG,EAAE,YAAM;AACvD,iBAAC,CAAC,eAAe,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;aAC/C,CAAC,CAAC;SACN,CAAC,CAAC;;AAEH,SAAC,CAAC,eAAe,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,YAAK;AAChC,aAAC,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC;AAChE,aAAC,CAAC,oBAAoB,CAAC,CAAC,OAAO,CAAC,EAAC,OAAO,EAAE,CAAC,EAAC,EAAE,GAAG,EAAE,YAAK;AACpD,iBAAC,CAAC,eAAe,CAAC,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC;aAClD,CAAC,CAAC;SACN,CAAC,CAAC;;AAEH,SAAC,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,UAAC,CAAC,EAAK;AAC7B,aAAC,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC;AAChE,aAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;AAC5C,aAAC,CAAC,eAAe,CAAC,CAAC,IAAI,EAAE,CAAC;AAC1B,aAAC,CAAC,eAAe,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;SACvC,CAAC,CAAC;;AAEH,SAAC,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,UAAC,CAAC,EAAK;AAC3B,gBAAG,CAAC,CAAC,OAAO,IAAI,EAAE,EAAC;AACf,iBAAC,CAAC,eAAe,CAAC,CAAC,IAAI,EAAE,CAAC;AAC1B,iBAAC,CAAC,UAAU,CAAC,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC;aAC7C;SACJ,CAAC,CAAC;;AAEH,SAAC,CAAC,mBAAmB,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,YAAI;AACnC,aAAC,CAAC,eAAe,CAAC,CAAC,IAAI,EAAE,CAAC;AAC1B,aAAC,CAAC,UAAU,CAAC,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC;SAC7C,CAAC,CAAC;;AAEH,SAAC,CAAC,eAAe,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,UAAC,CAAC,EAAK;AAClC,qBAAS,CAAC,WAAW,CAAC,OAAO,CAAC,UAAA,CAAC,EAAI;AAC/B,yBAAS,CAAC,eAAe,CAAC,MAAM,EAAE,CAAC,EAAE,MAAM,CAAC,CAAA;aAC/C,CAAC,CAAC;AACH,qBAAS,CAAC,eAAe,CAAC,MAAM,EAAE,WAAW,EAAE,SAAS,CAAC,CAAC;AAC1D,aAAC,CAAC,iBAAiB,CAAC,CAAC,IAAI,CAAC,UAAC,CAAC,EAAE,EAAE;uBAAK,CAAC,CAAC,EAAE,CAAC,CAAC,WAAW,CAAC,UAAU,CAAC;aAAA,CAAC,CAAC;AACpE,aAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;SAC3C,CAAC,CAAC;;AAEH,SAAC,CAAC,gBAAgB,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,UAAC,CAAC,EAAK;AACnC,qBAAS,CAAC,WAAW,CAAC,OAAO,CAAC,UAAA,CAAC,EAAI;AAC/B,yBAAS,CAAC,eAAe,CAAC,MAAM,EAAE,CAAC,EAAE,MAAM,CAAC,CAAA;aAC/C,CAAC,CAAC;AACH,qBAAS,CAAC,eAAe,CAAC,MAAM,EAAE,YAAY,EAAE,SAAS,CAAC,CAAC;AAC3D,aAAC,CAAC,iBAAiB,CAAC,CAAC,IAAI,CAAC,UAAC,CAAC,EAAE,EAAE;uBAAK,CAAC,CAAC,EAAE,CAAC,CAAC,WAAW,CAAC,UAAU,CAAC;aAAA,CAAC,CAAC;AACpE,aAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;SAC3C,CAAC,CAAC;;AAEH,SAAC,CAAC,gBAAgB,CAAC,CAAC,EAAE,CAAC,OAAO,EAAE,UAAC,CAAC,EAAK;AACnC,qBAAS,CAAC,WAAW,CAAC,OAAO,CAAC,UAAA,CAAC,EAAI;AAC/B,yBAAS,CAAC,eAAe,CAAC,MAAM,EAAE,CAAC,EAAE,MAAM,CAAC,CAAC;aAChD,CAAC,CAAC;AACH,qBAAS,CAAC,eAAe,CAAC,MAAM,EAAE,YAAY,EAAE,SAAS,CAAC,CAAC;AAC3D,aAAC,CAAC,iBAAiB,CAAC,CAAC,IAAI,CAAC,UAAC,CAAC,EAAE,EAAE;uBAAK,CAAC,CAAC,EAAE,CAAC,CAAC,WAAW,CAAC,UAAU,CAAC;aAAA,CAAC,CAAC;AACpE,aAAC,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;SAC3C,CAAC,CAAC;KACN;;;;;;AAMD,oBAAgB,EAAE,4BAAU;AACxB,eAAO,CAAC,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAA;KACvC;;;;;;;AAOD,2BAAuB,EAAE,iCAAS,KAAK,EAAC;AACpC,eAAO,CAAC,CAAC,IAAI,CAAC,iBAAiB,GAAG,KAAK,CAAC,CAAC;KAC5C;;AAED,kBAAc,EAAE,wBAAS,IAAI,EAAC;AAC1B,YAAI,OAAO,GAAG,EAAE,CAAC;AACjB,eAAO,CAAC,IAAI,GAAG,mBAAmB,CAAC;AACnC,eAAO,CAAC,QAAQ,GAAG,EAAE,CAAA;;;;;;AACrB,iCAAc,IAAI,8HAAC;oBAAV,CAAC;;AACN,oBAAI,WAAW,GAAG,EAAE,CAAC;AACrB,iBAAC,CAAC,WAAW,CAAC,OAAO,CAAC,UAAS,CAAC,EAAC;AAC7B,wBAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;AACb,qBAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;AACZ,qBAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;AACT,+BAAW,CAAC,IAAI,CAAC,CAAC,CAAC,CAAA;iBACtB,CAAC,CAAC;AACH,oBAAI,OAAO,GAAG,EAAE,CAAC;AACjB,uBAAO,CAAC,IAAI,GAAG,SAAS,CAAC;AACzB,uBAAO,CAAC,UAAU,GAAE;AAChB,4BAAQ,EAAE,CAAC,CAAC,QAAQ;iBACvB,CAAC;AACF,uBAAO,CAAC,QAAQ,GAAG;AACf,0BAAM,EAAE,YAAY;AACpB,iCAAa,EAAE,AAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,GAAG,EAAC,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAE,MAAM,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,GAAG,EAAC,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC;iBACpG,CAAC;AACF,uBAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;aAClC;;;;;;;;;;;;;;;;AACD,eAAO,OAAO,CAAC;KAClB;;AAED,gBAAY,EAAE,sBAAU,GAAG,EAAE,UAAU,EAAE,OAAO,EAAE,SAAS,EAAoC;YAAlC,OAAO,yDAAG,CAAC;YAAE,UAAU,yDAAG,MAAM;;AACzF,WAAG,CAAC,SAAS,CAAC,UAAU,EAAE;AACtB,kBAAM,EAAE,SAAS;AACjB,kBAAM,EAAE,OAAO;SAClB,CAAC,CAAC;;AAEH,cAAM,CAAC,QAAQ,CAAC;AACZ,gBAAI,EAAE,UAAU;AAChB,kBAAM,EAAE,MAAM;AACd,oBAAQ,EAAE,UAAU;AACpB,yBAAa,EAAE,IAAI;AACnB,oBAAQ,EAAE;AACN,2BAAW,EAAE,OAAO;AACpB,0BAAU,EAAE,OAAO;aACtB;AACD,mBAAO,EAAE;AACL,4BAAY,EAAE,SAAS;AACvB,gCAAgB,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;AACxB,4BAAY,EAAE,EAAC,OAAO,EAAE,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,EAAC;AAC5C,8BAAc,EAAE,OAAO;aAC1B;SACJ,CAAC,CAAC;;AAEH,iBAAS,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;;AAEvC,iBAAS,CAAC,eAAe,CAAC,MAAM,EAAE,UAAU,EAAE,UAAU,CAAC,CAAC;KAC7D;;;;;;;;AAQD,mBAAe,EAAE,yBAAS,GAAG,EAAE,OAAO,EAAmB;YAAjB,IAAI,yDAAG,SAAS;;AACpD,WAAG,CAAC,iBAAiB,CAAC,OAAO,EAAE,YAAY,EAAE,IAAI,CAAC,CAAC;KACtD;CACJ,CAAC;;AAEF,IAAI,MAAM,GAAG,SAAS,CAAC,OAAO,EAAE,CAAC;;AAGjC,MAAM,CAAC,EAAE,CAAC,YAAY,EAAE,YAAK;AACzB,aAAS,CAAC,uBAAuB,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,CACpE,IAAI,CAAC,UAAS,OAAO,EAAC;AACvB,iBAAS,CAAC,YAAY,CAAC,MAAM,EAAE,WAAW,EAAE,OAAO,EAAE,SAAS,EAAE,GAAG,CAAC,CAAA;KACvE,CAAC,CAAC;;AAEH,aAAS,CAAC,uBAAuB,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,CACtE,IAAI,CAAC,UAAS,OAAO,EAAC;AACnB,iBAAS,CAAC,YAAY,CAAC,MAAM,EAAE,YAAY,EAAE,OAAO,EAAE,SAAS,EAAE,GAAG,EAAE,SAAS,CAAC,CAAC;KAEpF,CAAC,CAAC;;AAEP,aAAS,CAAC,uBAAuB,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,CACtE,IAAI,CAAC,UAAS,OAAO,EAAC;AACnB,iBAAS,CAAC,YAAY,CAAC,MAAM,EAAE,YAAY,EAAE,OAAO,EAAE,SAAS,CAAC,CAAA;KACnE,CAAC,CAAC;;AAEP,UAAM,CAAC,EAAE,CAAC,MAAM,EAAE,YAAK;;;AAGnB,iBAAS,CAAC,YAAY,EAAE,CAAC;KAC5B,CAAC,CAAC;CAKN,CAAC,CAAC","file":"tube-walking-map.js","sourcesContent":["/**\n * Created by wwymak on 19/12/2015.\n */\n\nvar mapWidget = {\n    initMap: function(){\n        mapboxgl.accessToken = 'pk.eyJ1Ijoid3d5bWFrIiwiYSI6IkxEbENMZzgifQ.pxk3bdzd7n8h4pKzc9zozw';\n        var map = new mapboxgl.Map({\n            container: 'map', // container id\n            style: 'mapbox://styles/mapbox/emerald-v8', //stylesheet location\n            center: [-0.1275, 51.5072], // starting position\n            zoom: 12, // starting zoom\n            minZoom: 9\n        });\n        mapWidget.mapLayerIDs = [];\n\n        //mapWidget.loadDataInDistanceRange('0-0.6').then(mapWidget.parseToGeojson)\n        //    .then(function(geojson){\n        //        mapWidget.addDataToMap(ldnMap, \"less5mins\", geojson, \"#dd3497\", 0.8)\n        //    });\n        //\n        //mapWidget.loadDataInDistanceRange('0.6-1.8').then(mapWidget.parseToGeojson)\n        //    .then(function(geojson){\n        //        mapWidget.addDataToMap(ldnMap, \"less15mins\", geojson, \"#005a32\", 0.5)\n        //    });\n        //\n        //mapWidget.loadDataInDistanceRange('1.8-3.6').then(mapWidget.parseToGeojson)\n        //    .then(function(geojson){\n        //        mapWidget.addDataToMap(ldnMap, \"less30mins\", geojson, \"#8c96c6\")\n        //    })\n\n        return map;\n    },\n\n    initControls: function() {\n        $(\"#settingBtn\").on('click', (e) =>{\n            $(\".toolbar\").find(\".btn-selected\").removeClass(\"btn-selected\");\n            $(e.currentTarget).addClass(\"btn-selected\");\n            $(\"#map-panel-content\").animate({\"width\": 280}, 500, () => {\n                $(\"#closeMenuBtn\").addClass('panel-active');\n            });\n        });\n\n        $(\"#searchBtn\").on('click', (e) =>{\n            $(\".toolbar\").find(\".btn-selected\").removeClass(\"btn-selected\");\n            $(e.currentTarget).addClass(\"btn-selected\");\n            $(\"#map-panel-content\").animate({\"width\": 280}, 500, () => {\n                $(\"#closeMenuBtn\").addClass('panel-active');\n            });\n        });\n\n        $(\"#closeMenuBtn\").on('click', () =>{\n            $(\".toolbar\").find(\".btn-selected\").removeClass(\"btn-selected\");\n            $(\"#map-panel-content\").animate({\"width\": 0}, 500, () =>{\n                $(\"#closeMenuBtn\").removeClass('panel-active');\n            });\n        });\n\n        $(\"#infoBtn\").on(\"click\", (e) => {\n            $(\".toolbar\").find(\".btn-selected\").removeClass(\"btn-selected\");\n            $(e.currentTarget).addClass(\"btn-selected\");\n            $(\"#infoLightBox\").show();\n            $(\"#closeMenuBtn\").trigger(\"click\");\n        });\n\n        $(document).on('keyup', (e) => {\n            if(e.keyCode == 27){\n                $(\"#infoLightBox\").hide();\n                $(\"#infoBtn\").removeClass(\"btn-selected\");\n            }\n        });\n\n        $(\"#closeLightBoxBtn\").on(\"click\", ()=>{\n            $(\"#infoLightBox\").hide();\n            $(\"#infoBtn\").removeClass(\"btn-selected\");\n        });\n\n        $(\"#less5minsBtn\").on('click', (e) => {\n            mapWidget.mapLayerIDs.forEach(d => {\n                mapWidget.showOrHIdeLayer(ldnMap, d, \"none\")\n            });\n            mapWidget.showOrHIdeLayer(ldnMap, \"less5mins\", \"visible\");\n            $(\".layer-selector\").each((d, el) => $(el).removeClass(\"selected\"));\n            $(e.currentTarget).addClass(\"selected\");\n        });\n\n        $(\"#less15minsBtn\").on('click', (e) => {\n            mapWidget.mapLayerIDs.forEach(d => {\n                mapWidget.showOrHIdeLayer(ldnMap, d, \"none\")\n            });\n            mapWidget.showOrHIdeLayer(ldnMap, \"less15mins\", \"visible\");\n            $(\".layer-selector\").each((d, el) => $(el).removeClass(\"selected\"));\n            $(e.currentTarget).addClass(\"selected\");\n        });\n\n        $(\"#less30minsBtn\").on('click', (e) => {\n            mapWidget.mapLayerIDs.forEach(d => {\n                mapWidget.showOrHIdeLayer(ldnMap, d, \"none\");\n            });\n            mapWidget.showOrHIdeLayer(ldnMap, \"less30mins\", \"visible\");\n            $(\".layer-selector\").each((d, el) => $(el).removeClass(\"selected\"));\n            $(e.currentTarget).addClass(\"selected\");\n        });\n    },\n\n    /**\n     * query db for tube stations data that are within five mins walk of each other\n     * @returns {*} jquery deferred promise\n     */\n    loadFiveMinsData: function(){\n        return $.ajax('/api/five-mins-walk')\n    },\n\n    /**\n     *\n     * @param range e.g. 0.6-1.2 (in kms) for approx walking time of 5-10 mins\n     * @returns {*} jquery deferred\n     */\n    loadDataInDistanceRange: function(range){\n        return $.ajax('/api/distRange/' + range);\n    },\n\n    parseToGeojson: function(data){\n        var geoJson = {};\n        geoJson.type = \"FeatureCollection\";\n        geoJson.features = []\n        for (let i of data){\n            var routePoints = [];\n            i.routePoints.forEach(function(d){\n                var b = d[1];\n                d[1] = d[0];\n                d[0] = b;\n                routePoints.push(d)\n            });\n            let feature = {};\n            feature.type = \"Feature\";\n            feature.properties= {\n                distance: i.distance\n            };\n            feature.geometry = {\n                \"type\": \"LineString\",\n                \"coordinates\": ([[i.point1.lng,i.point1.lat]]).concat(routePoints, [[i.point2.lng,i.point2.lat]])\n            };\n            geoJson.features.push(feature);\n        }\n        return geoJson;\n    },\n\n    addDataToMap: function (map, sourceName, geojson, lineColor, opacity = 1, visibility = \"none\") {\n        map.addSource(sourceName, {\n            \"type\": \"geojson\",\n            \"data\": geojson\n        });\n\n        ldnMap.addLayer({\n            \"id\": sourceName,\n            \"type\": \"line\",\n            \"source\": sourceName,\n            \"interactive\": true,\n            \"layout\": {\n                \"line-join\": \"round\",\n                \"line-cap\": \"round\",\n            },\n            \"paint\": {\n                \"line-color\": lineColor,\n                \"line-dasharray\": [2, 2],\n                \"line-width\": {\"stops\": [[2, 0.5], [12, 2]]},\n                \"line-opacity\": opacity,\n            }\n        });\n\n        mapWidget.mapLayerIDs.push(sourceName);\n\n        mapWidget.showOrHIdeLayer(ldnMap, sourceName, visibility);\n    },\n\n    /**\n     *\n     * @param map\n     * @param layerID -- maplayer id as specified in addLayer\n     * @param show -- 'visible' or 'none'\n     */\n    showOrHIdeLayer: function(map, layerID, show = 'visible'){\n        map.setLayoutProperty(layerID, 'visibility', show);\n    }\n};\n\nvar ldnMap = mapWidget.initMap();\n\n\nldnMap.on('style.load', () =>{\n    mapWidget.loadDataInDistanceRange('0-0.6').then(mapWidget.parseToGeojson)\n        .then(function(geojson){\n        mapWidget.addDataToMap(ldnMap, \"less5mins\", geojson, \"#dd3497\", 0.8)\n    });\n\n    mapWidget.loadDataInDistanceRange('0.6-1.8').then(mapWidget.parseToGeojson)\n        .then(function(geojson){\n            mapWidget.addDataToMap(ldnMap, \"less15mins\", geojson, \"#005a32\", 0.5, \"visible\");\n\n        });\n\n    mapWidget.loadDataInDistanceRange('1.8-3.6').then(mapWidget.parseToGeojson)\n        .then(function(geojson){\n            mapWidget.addDataToMap(ldnMap, \"less30mins\", geojson, \"#8c96c6\")\n        });\n\n    ldnMap.on('load', ()=> {\n\n        //mapWidget.showOrHIdeLayer(ldnMap, \"less15mins\", \"visible\");\n        mapWidget.initControls();\n    });\n\n\n\n\n});"]}